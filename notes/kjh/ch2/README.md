# ch2. 현실에서의 함수형 사고

> 피자 가게 운영 소프트웨어의 예를 들어 설명

## 1. 계층형 설계
> 자주 바뀌지 않는 것을 가장 밑으로, 자주 바뀌는 것을 가장 위로 배치

### 메인 레이어 (수직 구조로 각 단계를 명확히 분리)
- (자주 바뀌는 것)
- 비즈니스 규칙 -> 바로 아래 계층(도메인)에 있는 것을 기반으로 구현
- 도메인 규칙 -> 바로 아래 계층(기술 스택)에 있는 것을 기반으로 구현
- 기술 스택
- (자주 바뀌지 않는 것)

예) 피자 주방 레이어
- (자주 바뀌는 것)
- 비즈니스 규칙: 이번주 메뉴(이번주 특별 메뉴 조리법)
- 도메인 규칙: 피자 만들기(조리법 순서)
- 기술 스택: 자바스크립트(객체, 배열 문법)
- (자주 바뀌지 않는 것)

예) 창고 레이어
- (자주 바뀌는 것)
- 비즈니스 규칙: 이번주 살 것(재료)
- 도메인 규칙: 저장된 식재료 목록
- 기술 스택: 자바스크립트(객체, 배열 문법)
- (자주 바뀌지 않는 것)

### 계층형 설계의 장점
계층형 구조의 소프트웨어는 코드 변경이 용이
- 가장 위의 코드는 의존성이 거의 없어서 쉽게 바꿀 수 있음
- 아래의 코드는 의존성이 많아 바꾸기 어렵지만, 자주 바뀌지 않음
- 테스트, 재사용, 유지보수 쉬움

## 2. 분산 시스템
### 순차 시스템
피자 주문 접수 ~ 서빙까지 각 액션 타임라인
- 주문 접수
- 반죽 만들기
- 반죽 펴기: 반죽 ready 필요
- 소스 만들기
- 소스 뿌리기: 소스 ready 필요
- 치즈 갈기
- 치즈 뿌리기: 치즈 ready 필요
- 오븐에 넣기
- 10분 기다리기
- 서빙

너무 느린데..

### 순차 시스템을 분산 시스템으로 바꾸기
반죽, 소스, 치즈 준비를 병렬적으로 한다면 속도를 낼 수 있을 듯!
- 문제: 반죽 만들기 단계에서 반죽이 아직 준비되지 않을 수도 있음(순서 보장이 안되는 경우)
  - 타임라인이 서로 맞춰지지 않아 예측 불가능한 순서로 진행되어 버림

타임라인 커팅으로 문제 해결
- 여러 타임라인이 동시에 진행될 때 순서를 보장
- 고차 동작(high-order operation)으로 구현
- 예) 반죽, 소스, 치즈 모두 준비되면 반죽을 펴기 시작